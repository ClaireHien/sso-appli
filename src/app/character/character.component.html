<div *ngIf="character" class="opacity-40 bg-img h-screen fixed top-0 left-0 w-screen z-0" [ngStyle]="{'background-image': 'url(../../assets/image/landscape/' + character.group.world.image + ')'}"></div>


<section *ngIf="character" class="grid lg:grid-cols-3 pt-20 pl-5 pr-5 pb-20 gap-3 relative z-10 md:grid-cols-2 grid-cols-1">
    
    <div class="global col-span-2 row-span-2 bg-white rounded" [ngClass]="{'bg-gradient':formGlobal}">
        
        <app-global *ngIf="!formGlobal"
        [character]="character"
        ></app-global>

        <app-global-form *ngIf="formGlobal && createdByUser" (formSubmitted)="swapGlobal()"
        [character]="character"
        ></app-global-form>

        <div (click)="swapGlobal()" *ngIf="createdByUser" class="uppercase float-right tracking-widest text-mid3 text-xs my-2 mx-5 cursor-pointer">
            <span *ngIf="!formGlobal">Modifier</span>
            <span *ngIf="formGlobal">Annuler</span>
        </div>

    </div>

    <div class="p-2 bg-black2 rounded text-xs uppercase tracking-widest grid grid-cols-2">
        <strong class="justify-self-end text-white pr-3">Joueur</strong><span>{{character.user.name}}</span>
        <strong class="justify-self-end text-white pr-3">Groupe </strong><span>{{character.group.name}}</span>
        <strong class="justify-self-end text-white pr-3">Monde </strong><span>{{character.group.world.name}}</span>
    </div>

    <div class="rounded bg-white6 hover:bg-white pb-5 row-span-2 spirit" [ngClass]="{'bg-gradient':formSpirit}">
        <div class="grid">
            <p class="m-3 p-3 bg-white opacity-0 hover:opacity-100 relative z-10 text-sm font-light leading-4 text-justify">{{character.spirit.description}}</p>
            <img [src]="character.spirit.image" class="rounded h-52 overflow-hidden w-full object-cover">
        </div>
        <h2 class="mt-3 mb-0 font-blakely uppercase tracking-widest text-center text-3xl">{{character.spirit.name}}</h2>

        <div (click)="swapSpirit()" *ngIf="createdByUser" class="uppercase text-center tracking-widest text-mid3 text-xs my-2 mx-5 cursor-pointer">
            <span *ngIf="!formSpirit">Modifier</span>
            <span *ngIf="formSpirit">Annuler</span>
        </div>

        <app-spirit *ngIf="!formSpirit"
            [character]="character"
        ></app-spirit>

        <app-spirit-form *ngIf="formSpirit && createdByUser" (formSubmitted)="swapSpirit()"
            [character]="character"
        ></app-spirit-form>

    </div>

    <div class="col-span-2 rounded bg-white6 hover:bg-white grid items-center grid-cols-3 p-5">

        <div class="text-center">
            <span class="uppercase tracking-widest pt-2">Niveau</span>
            <strong class="block text-3xl">{{character.level}}</strong>
        </div>
        <div class="col-span-2">
            <div>
                <span class="uppercase tracking-widest text-mid4 text-xs pr-2">Points de compétences</span><strong>{{character.pc}}</strong>
            </div>
            <div>
                <span class="uppercase tracking-widest text-mid4 text-xs pr-2">Points d'expériences</span><strong>{{character.xp}} / 10</strong>
            </div>
            <div class="form-level flex justify-between" *ngIf="createdByUser">
                <form [formGroup]="formAddXp" (ngSubmit)="onSubmitAddXp()" class="flex text-mid3 items-center">

                    <label class="font-bold uppercase tracking-widest text-xs pr-2" for="xp">Ajouter de l'expérience</label>
                    <input class="w-12 p-1 font-bold bg-transparent text-center" formControlName="xp">
                    <button type="submit" class="font-bold text-4xl hover:text-mid5 flex items-center"><i class="fa-solid fa-circle-plus"></i></button>
                    
                </form>
                <button class="ml-10 uppercase tracking-widest bg-mid3 hover:bg-mid5 rounded text-white pt-2 pb-1 px-3" (click)="dead()">Mort
                    <span class="text-light3 text-xs pl-1">(-5XP)</span></button>

            </div>
            
        </div>
        
    </div>

    <div class="bg-white8 hover:bg-white rounded pb-1" [ngClass]="{'bg-gradient':formStatPhysical}">
        <h2 class="text-center font-blakely text-3xl tracking-widest pt-5">Le corps</h2>
        <div (click)="swapStatPhysical()" *ngIf="createdByUser" class="uppercase text-center tracking-widest mx-5 text-mid3 text-xs cursor-pointer">
            <span *ngIf="!formStatPhysical">Modifier</span>
            <span *ngIf="formStatPhysical">Annuler</span>
        </div>

        <app-statistic *ngIf="!formStatPhysical"
            [character]="character"
            [type]="'physical'"
            [createdByUser]="createdByUser"
        ></app-statistic>

        <app-statistic-form *ngIf="formStatPhysical && createdByUser" (formSubmitted)="swapStatPhysical()"
            [character]="character"
            [type]="'physical'"
        ></app-statistic-form>

    </div>
    <div class="bg-white8 row-span-2 hover:bg-white rounded" [ngClass]="{'bg-gradient':formStatMain}">
        <h2 class="text-center font-blakely text-5xl tracking-widest pt-5">Statistiques</h2>

        <div (click)="swapStatMain()" *ngIf="createdByUser" class="uppercase text-center tracking-widest mx-5 text-mid3 text-xs cursor-pointer">
            <span *ngIf="!formStatMain">Modifier</span>
            <span *ngIf="formStatMain">Annuler</span>
        </div>

        <app-main-statistic *ngIf="!formStatMain"
            [character]="character"
            [createdByUser]="createdByUser"
        ></app-main-statistic>

        <app-main-statistic-form *ngIf="formStatMain && createdByUser" (formSubmitted)="swapStatMain()"
            [character]="character"
        ></app-main-statistic-form>

    </div>
    <div class="bg-white8 hover:bg-white rounded pb-1" [ngClass]="{'bg-gradient':formStatMagic}">
        <h2 class="text-center font-blakely text-3xl tracking-widest pt-5">L'esprit</h2>
        <div (click)="swapStatMagic()" *ngIf="createdByUser" class="uppercase text-center tracking-widest mx-5 text-mid3 text-xs cursor-pointer">
            <span *ngIf="!formStatMagic">Modifier</span>
            <span *ngIf="formStatMagic">Annuler</span>
        </div>

        <app-statistic *ngIf="!formStatMagic"
            [character]="character"
            [type]="'magic'"
            [createdByUser]="createdByUser"
        ></app-statistic>

        <app-statistic-form *ngIf="formStatMagic && createdByUser" (formSubmitted)="swapStatMagic()"
            [character]="character"
            [type]="'magic'"
        ></app-statistic-form>

    </div>
    
    <div class="bg-white6 row-span-2 hover:bg-white rounded pb-1"  [ngClass]="{'bg-gradient':formClothe}">
        <h4 class="uppercase mt-3 font-bold text-center">Vêtements & Ornements</h4>
        <div (click)="swapClothe()" *ngIf="createdByUser" class="uppercase text-center tracking-widest mx-5 text-mid3 text-xs cursor-pointer">
            <span *ngIf="!formClothe">Modifier</span>
            <span *ngIf="formClothe">Annuler</span>
        </div>
        <app-stuff *ngIf="!formClothe"
            [character]="character"
            [type]="'Clothe'"
        ></app-stuff>
        <app-stuff-form *ngIf="formClothe"
            [character]="character"
            [type]="'Clothe'"
        ></app-stuff-form>
    </div>
    <div class="bg-white6 row-span-2 hover:bg-white rounded pb-1"  [ngClass]="{'bg-gradient':formJewelry}">
        <h4 class="uppercase mt-3 font-bold text-center">Bijoux & Pierres</h4>
        <div (click)="swapJewelry()" *ngIf="createdByUser" class="uppercase text-center tracking-widest mx-5 text-mid3 text-xs cursor-pointer">
            <span *ngIf="!formJewelry">Modifier</span>
            <span *ngIf="formJewelry">Annuler</span>
        </div>
        <app-stuff *ngIf="!formJewelry"
            [character]="character"
            [type]="'Jewelry'"
        ></app-stuff>
        <app-stuff-form *ngIf="formJewelry"
            [character]="character"
            [type]="'Jewelry'"
        ></app-stuff-form>
    </div>
    <div class="bg-white6 hover:bg-white rounded pb-1"  [ngClass]="{'bg-gradient':formWeapon}">
        <h4 class="uppercase mt-3 font-bold text-center">Arme & Armure</h4>
        <div (click)="swapWeapon()" *ngIf="createdByUser" class="uppercase text-center tracking-widest mx-5 text-mid3 text-xs cursor-pointer">
            <span *ngIf="!formWeapon">Modifier</span>
            <span *ngIf="formWeapon">Annuler</span>
        </div>
        <app-stuff *ngIf="!formWeapon"
            [character]="character"
            [type]="'Weapon'"
        ></app-stuff>
        <app-stuff-form *ngIf="formWeapon"
            [character]="character"
            [type]="'Weapon'"
        ></app-stuff-form>
    </div>

    <div class="bg-white4 hover:bg-white p-3 rounded">
        <h3 class="uppercase font-bold tracking-widest text-center mt-2">Cristaux</h3>
        <div class="text-3xl text-center tracking-widest font-bold">{{character.money}}</div>
        <form [formGroup]="formAddMoney" *ngIf="createdByUser" class="dot-top pt-3 mt-3 flex flex-col items-center justify-center">
            <input class="w-12 p-1 font-bold bg-transparent text-center mb-2" formControlName="money">
            <div class="flex gap-3">
                <button type="submit" (click)="onSubmitMoney('sub')" class="px-4 text-xs rounded w-full z-10 font-bold uppercase tracking-widest bg-light1 pt-2 pb-1 hover:bg-light3">Retirer</button>
                <button type="submit" (click)="onSubmitMoney('add')" class="px-4 text-xs rounded w-full z-10 font-bold uppercase tracking-widest bg-mid3 pt-2 pb-1 hover:bg-mid5">Ajouter</button>
            </div>

        </form>

    </div>
    <div class="row-span-2 bg-white4 hover:bg-white p-3 rounded">
        <h3 class="text-center font-blakely uppercase tracking-widest text-4xl mb-3">Matériaux</h3>
        
        <div *ngFor="let material of groupedMaterials" class="flex justify-between items-start">
            <div class="material">
                <strong>{{material.name}}</strong>
                <span class="text-xs mx-1">({{material.quantity}})</span>
                <span class="text-mid4 pl-1 uppercase tracking-widest text-2xs">{{material.type_material.label}} - revente {{roundDown(material.price/4)}} C</span>
                <div *ngFor="let table of material.craft_tables" class="text-xs pl-5 mt-1">
                    <div class="uppercase tracking-widest">{{table.craft.name}}</div>
                    <div class="grid" style="grid-template-columns: 1fr 2fr;">
                        <strong class="uppercase pr-1 text-mid4">Médiocre</strong><span>{{table.poor}}</span>
                        <strong class="uppercase pr-1 text-mid4">Correct</strong><span>{{table.fair}}</span>
                        <strong class="uppercase pr-1 text-mid4">Bon</strong><span>{{table.good}}</span>
                        <strong class="uppercase pr-1 text-mid4">Super</strong><span>{{table.super}}</span>
                        <strong class="uppercase pr-1 text-mid4">Excellent</strong><span>{{table.excellent}}</span>
                    </div>
                </div>
                <div *ngIf="material.material_table" class="text-xs pl-5 mt-1">
                    <div class="grid" style="grid-template-columns: 1fr 2fr;">
                        <strong class="uppercase pr-1 text-mid4">Sauvage</strong><span>{{material.material_table.wild}}</span>
                        <strong class="uppercase pr-1 text-mid4">Mystérieux</strong><span>{{material.material_table.mysterious}}</span>
                        <strong class="uppercase pr-1 text-mid4">Elegant</strong><span>{{material.material_table.elegant}}</span>
                    </div>
                </div>
            </div>
            <div *ngIf="createdByUser" class="flex gap-1">
                <i class="fa-solid fa-circle-minus text-xl text-light5 cursor-pointer hover:text-mid3"></i>
                <i class="fa-solid fa-circle-plus text-xl text-mid2 cursor-pointer hover:text-mid4"></i>
            </div>
        </div>

        <form *ngIf="createdByUser" [formGroup]="formAddMaterial" (ngSubmit)="onSubmitAddMaterial()" class="mt-2 dot-top flex flex-col items-center">
            <label for="material" class="uppercase tracking-widest font-bold mt-3">Ajouter un matériaux</label>
            <select class="w-full p-2 bg-white" id="material_id" name="material" formControlName="material_id">
                <option *ngFor="let material of materials" [value]="material.id">{{ material.name }}</option>
            </select>
            <button type="submit" class="font-bold rounded pt-2 pb-1 px-3 mt-2 uppercase tracking-widest bg-light1 flex items-center">Ajouter</button>
        </form>

    </div>
    <div class="row-span-2 bg-white4 hover:bg-white p-3 rounded">
        <h3 class="text-center font-blakely uppercase tracking-widest text-4xl mb-3">Inventaire</h3>
        
        <div *ngFor="let item of character.items" class="flex justify-between items-start">
            <div>
                <strong>{{item.name}}</strong>
                <span class="text-xs px-1">({{item.quantity}})</span>   
                <span class="font-light leading-4 text-justify" [innerHTML]="item.description"></span>
            </div>
            <div *ngIf="createdByUser" class="flex gap-1">
                <i class="fa-solid fa-circle-minus text-xl text-light5 cursor-pointer hover:text-mid3"></i>
                <i class="fa-solid fa-circle-plus text-xl text-mid2 cursor-pointer hover:text-mid4"></i>
            </div>
        </div>

        <form *ngIf="createdByUser" [formGroup]="formAddItem" (ngSubmit)="onSubmitAddItem()" class="dot-top flex flex-col items-center">
            <span class="uppercase tracking-widest font-bold mt-3">Ajouter un objet</span>
            <input class="p-1 w-full bg-transparent" formControlName="name" placeholder="nom de l'objet">
            <input class="p-1 font-light w-full bg-transparent" formControlName="description" placeholder="description de l'objet">
            <button type="submit" class="font-bold rounded pt-2 pb-1 px-3 mt-2 uppercase tracking-widest bg-light1 flex items-center">Ajouter</button>
        </form>

    </div>
    <div class="bg-white4 hover:bg-white items-center justify-items-center p-3 rounded grid grid-one">
        <i class="text-light1 text-7xl fa-solid fa-star" [ngClass]="{
            'text-black2':character.star==0,
            'rotate-star':character.star>0
        }"></i>
        <div class="relative z-10">
            <span class="font-blakely uppercase tracking-widest text-4xl">Etoiles</span>
            <div class="flex justify-center gap-4">
                <button *ngIf="createdByUser"><i class="text-mid3 hover:text-mid5 cursor-pointer text-2xl fa-solid fa-circle-minus"></i></button>
                <span class="font-bold text-4xl">{{character.star}}</span>
                
                <button *ngIf="createdByUser"><i class="text-mid3 hover:text-mid5 cursor-pointer text-2xl fa-solid fa-circle-plus"></i></button>
            </div>
        </div>
    </div>

    <div class="col-span-3 bg-mid4 text-white opacity-80 text-center rounded font-bold uppercase tracking-widest pt-2 pb-1">Compétences</div>

    <div class="flex flex-col gap-3 ">
    
        <app-neutral-skill *ngFor="let skill of character.fight_skills" 
            [skill]="skill"
            [character]="character"
            [type]="'Combat'"
            [createdByUser]="createdByUser"
        ></app-neutral-skill>
        <app-neutral-skill *ngFor="let skill of character.neutral_skills" 
            [skill]="skill"
            [character]="character"
            [type]="'Neutre'"
            [createdByUser]="createdByUser"
        ></app-neutral-skill>
        <app-neutral-skill *ngFor="let skill of character.craft_skills" 
            [skill]="skill"
            [character]="character"
            [type]="'Artisanat'"
            [createdByUser]="createdByUser"
        ></app-neutral-skill>
        <app-neutral-skill *ngFor="let skill of character.personnal_skills" 
            [skill]="skill"
            [character]="character"
            [type]="'Autre'"
            [createdByUser]="createdByUser"
        ></app-neutral-skill>

        <button *ngIf="createdByUser" class="bg-mid4 text-white rounded uppercase tracking-widest hover:bg-mid2 font-bold pt-2 pb-1" (click)="addNeutralSkill()">AJouter une compétence neutre</button>

    </div>
    <div class="flex flex-col gap-3 col-start-2 col-span-2">
            
        <app-character-tree *ngFor="let tree of character.trees" 
            [tree]="tree"
            [character]="character"
            [createdByUser]="createdByUser"
        ></app-character-tree>

        <button *ngIf="createdByUser" class="bg-mid4 text-white rounded uppercase tracking-widest hover:bg-mid2 font-bold pt-2 pb-1" (click)="addTree()">AJouter un arbre de compétences</button>


    </div>

</section>